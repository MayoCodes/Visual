<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaptionCraft - Professional Video Caption Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #667eea;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .editor-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 800px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            margin: 40px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #e8ecff;
            transform: translateY(-2px);
        }

        .upload-area.drag-over {
            border-color: #4CAF50;
            background: #e8f5e8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #333;
        }

        .upload-subtext {
            color: #666;
            font-size: 1rem;
        }

        .editor-workspace {
            display: none;
            grid-template-columns: 1fr 350px;
            height: 800px;
        }

        .main-editor {
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }

        .video-preview {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 800px;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .caption-overlay {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 500;
            max-width: 80%;
            text-align: center;
            word-wrap: break-word;
            transition: all 0.3s ease;
            z-index: 10;
            cursor: move;
            user-select: none;
            border: 2px solid transparent;
        }

        .caption-overlay:hover {
            border-color: #667eea;
        }

        .caption-overlay.dragging {
            border-color: #ff6b35;
            box-shadow: 0 4px 12px rgba(255,107,53,0.3);
        }

        .timeline-container {
            height: 180px;
            background: #2c3e50;
            padding: 20px;
            overflow-x: auto;
        }

        .timeline-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-markers {
            position: relative;
            height: 20px;
            margin-bottom: 5px;
        }

        .time-marker {
            position: absolute;
            top: 0;
            width: 2px;
            height: 20px;
            background: rgba(255,255,255,0.3);
        }

        .time-marker.major {
            height: 20px;
            background: rgba(255,255,255,0.6);
        }

        .time-label {
            position: absolute;
            top: -18px;
            font-size: 10px;
            color: rgba(255,255,255,0.7);
            transform: translateX(-50%);
            font-family: monospace;
        }

        .timeline {
            position: relative;
            height: 60px;
            background: #34495e;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .timeline:hover {
            border-color: #667eea;
        }

        .timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #667eea;
            border-radius: 10px;
            transition: width 0.1s ease;
        }

        .playhead {
            position: absolute;
            top: -5px;
            width: 4px;
            height: 70px;
            background: #ff6b35;
            border-radius: 2px;
            cursor: ew-resize;
            box-shadow: 0 0 10px rgba(255,107,53,0.5);
        }

        .caption-segments {
            position: relative;
            height: 40px;
            margin-top: 10px;
        }

        .caption-segment {
            position: absolute;
            height: 100%;
            background: rgba(255,107,53,0.8);
            border-radius: 5px;
            border: 2px solid #ff6b35;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            padding: 0 8px;
            font-size: 12px;
            color: white;
            overflow: hidden;
            white-space: nowrap;
        }

        .caption-segment:hover {
            background: rgba(255,107,53,1);
            transform: translateY(-2px);
        }

        .caption-segment.selected {
            border-color: #4CAF50;
            background: rgba(76,175,80,0.8);
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
        }

        .control-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .time-display {
            font-family: monospace;
            font-size: 16px;
            color: #666;
            min-width: 120px;
            text-align: center;
        }

        .sidebar {
            background: white;
            border-left: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
        }

        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .sidebar-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-input {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .range-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-input {
            flex: 1;
        }

        .range-value {
            min-width: 40px;
            text-align: center;
            font-weight: 500;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .caption-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .caption-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .caption-item:hover {
            background: #e9ecef;
        }

        .caption-item.selected {
            border-left-color: #667eea;
            background: #f0f4ff;
        }

        .caption-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .caption-text {
            font-size: 14px;
            color: #333;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .export-btn {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.3);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .editor-workspace {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }
            
            .sidebar {
                border-left: none;
                border-top: 1px solid #eee;
                max-height: 400px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎬 CaptionCraft</h1>
            <p>Professional Video Caption Editor with AI Transcription</p>
        </div>

        <div class="editor-container">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📁</div>
                <div class="upload-text">Drop your MP4 video here</div>
                <div class="upload-subtext">or click to browse files</div>
                <input type="file" id="fileInput" accept=".mp4,.mov,.avi,.webm" style="display: none;">
            </div>

            <div class="editor-workspace" id="editorWorkspace">
                <div class="main-editor">
                    <div class="video-preview">
                        <div class="video-container">
                            <video id="videoPlayer" controls>
                                Your browser does not support the video tag.
                            </video>
                            <div class="caption-overlay" id="captionOverlay"></div>
                        </div>
                    </div>

                    <div class="timeline-container">
                        <div class="timeline-wrapper">
                            <div class="timeline-markers" id="timelineMarkers"></div>
                            <div class="timeline" id="timeline">
                                <div class="timeline-progress" id="timelineProgress"></div>
                                <div class="playhead" id="playhead"></div>
                            </div>
                        </div>
                        <div class="caption-segments" id="captionSegments"></div>
                    </div>

                    <div class="controls">
                        <button class="control-btn" id="playPauseBtn">
                            <span>▶️</span> Play
                        </button>
                        <button class="control-btn" id="transcribeBtn">
                            <span>🎤</span> Auto Transcribe
                        </button>
                        <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                        <button class="control-btn" id="addCaptionBtn">
                            <span>➕</span> Add Caption
                        </button>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">Caption Editor</div>
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="edit">Edit</button>
                            <button class="tab-btn" data-tab="style">Style</button>
                            <button class="tab-btn" data-tab="list">List</button>
                        </div>
                    </div>

                    <div class="sidebar-content">
                        <div class="tab-panel active" id="editPanel">
                            <div class="form-group">
                                <label class="form-label">Caption Text</label>
                                <textarea class="form-input textarea" id="captionText" placeholder="Enter caption text..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Time (seconds)</label>
                                <input type="number" class="form-input" id="startTime" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time (seconds)</label>
                                <input type="number" class="form-input" id="endTime" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Position</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">X Position (%)</label>
                                        <input type="number" class="form-input" id="positionX" min="0" max="100" value="50">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">Y Position (%)</label>
                                        <input type="number" class="form-input" id="positionY" min="0" max="100" value="80">
                                    </div>
                                </div>
                            </div>
                            <button class="control-btn" id="updateCaptionBtn" style="width: 100%;">
                                Update Caption
                            </button>
                            <button class="control-btn" id="deleteCaptionBtn" style="width: 100%; background: #dc3545; margin-top: 10px;">
                                Delete Caption
                            </button>
                        </div>

                        <div class="tab-panel" id="stylePanel">
                            <div class="form-group">
                                <label class="form-label">Font Size</label>
                                <div class="range-group">
                                    <input type="range" class="range-input" id="fontSize" min="12" max="48" value="18">
                                    <span class="range-value" id="fontSizeValue">18px</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="textColor" value="#ffffff">
                                    <span>Text</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="backgroundColor" value="#000000">
                                    <span>Background</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Background Opacity</label>
                                <div class="range-group">
                                    <input type="range" class="range-input" id="backgroundOpacity" min="0" max="100" value="80">
                                    <span class="range-value" id="backgroundOpacityValue">80%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Font Weight</label>
                                <select class="form-input" id="fontWeight">
                                    <option value="normal">Normal</option>
                                    <option value="bold" selected>Bold</option>
                                    <option value="300">Light</option>
                                    <option value="600">Semi Bold</option>
                                    <option value="900">Extra Bold</option>
                                </select>
                            </div>
                            <div class="preset-buttons">
                                <button class="preset-btn" data-preset="youtube">YouTube Style</button>
                                <button class="preset-btn" data-preset="netflix">Netflix Style</button>
                                <button class="preset-btn" data-preset="minimal">Minimal</button>
                                <button class="preset-btn" data-preset="bold">Bold & Bright</button>
                            </div>
                        </div>

                        <div class="tab-panel" id="listPanel">
                            <div class="caption-list" id="captionList">
                                <div style="text-align: center; color: #666; padding: 40px;">
                                    No captions yet. Start by transcribing your video or adding captions manually.
                                </div>
                            </div>
                            <div class="export-section">
                                <button class="export-btn" id="exportBtn">
                                    📥 Export Video with Captions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading hidden" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3>Processing Video...</h3>
                <p>Transcribing audio and generating captions</p>
            </div>
        </div>
    </div>

    <script>
        class VideoCaptionEditor {
            constructor() {
                this.video = null;
                this.captions = [];
                this.currentCaption = null;
                this.isPlaying = false;
                this.duration = 0;
                this.currentTime = 0;
                this.isDraggingCaption = false;
                this.isDraggingPlayhead = false;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupDragAndDrop();
                this.setupCaptionDragging();
            }

            setupEventListeners() {
                // File upload
                document.getElementById('fileInput').addEventListener('change', this.handleFileSelect.bind(this));
                document.getElementById('uploadArea').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });

                // Video controls
                document.getElementById('playPauseBtn').addEventListener('click', this.togglePlayPause.bind(this));
                document.getElementById('transcribeBtn').addEventListener('click', this.startTranscription.bind(this));
                document.getElementById('addCaptionBtn').addEventListener('click', this.addCaption.bind(this));

                // Caption editing
                document.getElementById('updateCaptionBtn').addEventListener('click', this.updateCaption.bind(this));
                document.getElementById('deleteCaptionBtn').addEventListener('click', this.deleteCaption.bind(this));

                // Position controls
                document.getElementById('positionX').addEventListener('input', this.updateCaptionPosition.bind(this));
                document.getElementById('positionY').addEventListener('input', this.updateCaptionPosition.bind(this));

                // Timeline
                document.getElementById('timeline').addEventListener('click', this.seekToTime.bind(this));
                document.getElementById('playhead').addEventListener('mousedown', this.startDraggingPlayhead.bind(this));

                // Style controls
                document.getElementById('fontSize').addEventListener('input', this.updateStyle.bind(this));
                document.getElementById('textColor').addEventListener('change', this.updateStyle.bind(this));
                document.getElementById('backgroundColor').addEventListener('change', this.updateStyle.bind(this));
                document.getElementById('backgroundOpacity').addEventListener('input', this.updateStyle.bind(this));
                document.getElementById('fontWeight').addEventListener('change', this.updateStyle.bind(this));

                // Preset buttons
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', this.applyPreset.bind(this));
                });

                // Tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', this.switchTab.bind(this));
                });

                // Export
                document.getElementById('exportBtn').addEventListener('click', this.exportVideo.bind(this));
            }

            setupDragAndDrop() {
                const uploadArea = document.getElementById('uploadArea');

                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.loadVideo(files[0]);
                    }
                });
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.loadVideo(file);
                }
            }

            setupCaptionDragging() {
                const overlay = document.getElementById('captionOverlay');
                
                overlay.addEventListener('mousedown', (e) => {
                    if (!this.currentCaption) return;
                    
                    this.isDraggingCaption = true;
                    overlay.classList.add('dragging');
                    
                    const videoContainer = document.querySelector('.video-container');
                    const rect = videoContainer.getBoundingClientRect();
                    
                    const offsetX = e.clientX - (rect.left + (this.currentCaption.positionX || 50) * rect.width / 100);
                    const offsetY = e.clientY - (rect.top + (this.currentCaption.positionY || 80) * rect.height / 100);
                    
                    const onMouseMove = (e) => {
                        if (!this.isDraggingCaption) return;
                        
                        const rect = videoContainer.getBoundingClientRect();
                        const x = ((e.clientX - rect.left - offsetX) / rect.width) * 100;
                        const y = ((e.clientY - rect.top - offsetY) / rect.height) * 100;
                        
                        const clampedX = Math.max(0, Math.min(100, x));
                        const clampedY = Math.max(0, Math.min(100, y));
                        
                        this.currentCaption.positionX = clampedX;
                        this.currentCaption.positionY = clampedY;
                        
                        // Update form fields
                        document.getElementById('positionX').value = Math.round(clampedX);
                        document.getElementById('positionY').value = Math.round(clampedY);
                        
                        this.updateCaptionPosition();
                    };
                    
                    const onMouseUp = () => {
                        this.isDraggingCaption = false;
                        overlay.classList.remove('dragging');
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    };
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                    
                    e.preventDefault();
                });
            }

            loadVideo(file) {
                const videoURL = URL.createObjectURL(file);
                this.video = document.getElementById('videoPlayer');
                this.video.src = videoURL;
                
                this.video.addEventListener('loadedmetadata', () => {
                    this.duration = this.video.duration;
                    this.setupVideoEvents();
                    this.createTimelineMarkers();
                    this.showEditor();
                });
            }

            createTimelineMarkers() {
                const markersContainer = document.getElementById('timelineMarkers');
                markersContainer.innerHTML = '';
                
                const duration = this.duration;
                const intervals = this.getTimeIntervals(duration);
                
                intervals.forEach(time => {
                    const marker = document.createElement('div');
                    marker.className = time % 60 === 0 ? 'time-marker major' : 'time-marker';
                    
                    const percentage = (time / duration) * 100;
                    marker.style.left = `${percentage}%`;
                    
                    if (time % 10 === 0 || time % 60 === 0) {
                        const label = document.createElement('div');
                        label.className = 'time-label';
                        label.textContent = this.formatTime(time);
                        label.style.left = `${percentage}%`;
                        markersContainer.appendChild(label);
                    }
                    
                    markersContainer.appendChild(marker);
                });
            }

            getTimeIntervals(duration) {
                const intervals = [];
                
                if (duration <= 60) {
                    // For videos under 1 minute, show every 5 seconds
                    for (let i = 0; i <= duration; i += 5) {
                        intervals.push(i);
                    }
                } else if (duration <= 300) {
                    // For videos under 5 minutes, show every 10 seconds
                    for (let i = 0; i <= duration; i += 10) {
                        intervals.push(i);
                    }
                } else {
                    // For longer videos, show every 30 seconds
                    for (let i = 0; i <= duration; i += 30) {
                        intervals.push(i);
                    }
                }
                
                return intervals;
            }

            setupVideoEvents() {
                this.video.addEventListener('timeupdate', this.updateTimeline.bind(this));
                this.video.addEventListener('play', () => {
                    this.isPlaying = true;
                    this.updatePlayButton();
                });
                this.video.addEventListener('pause', () => {
                    this.isPlaying = false;
                    this.updatePlayButton();
                });
            }

            showEditor() {
                document.getElementById('uploadArea').style.display = 'none';
                document.getElementById('editorWorkspace').style.display = 'grid';
            }

            togglePlayPause() {
                if (this.isPlaying) {
                    this.video.pause();
                } else {
                    this.video.play();
                }
            }

            updatePlayButton() {
                const btn = document.getElementById('playPauseBtn');
                btn.innerHTML = this.isPlaying ? '<span>⏸️</span> Pause' : '<span>▶️</span> Play';
            }

            updateTimeline() {
                this.currentTime = this.video.currentTime;
                const progress = (this.currentTime / this.duration) * 100;
                
                document.getElementById('timelineProgress').style.width = `${progress}%`;
                document.getElementById('playhead').style.left = `${progress}%`;
                
                // Update time display
                const currentMin = Math.floor(this.currentTime / 60);
                const currentSec = Math.floor(this.currentTime % 60);
                const durationMin = Math.floor(this.duration / 60);
                const durationSec = Math.floor(this.duration % 60);
                
                document.getElementById('timeDisplay').textContent = 
                    `${currentMin.toString().padStart(2, '0')}:${currentSec.toString().padStart(2, '0')} / ${durationMin.toString().padStart(2, '0')}:${durationSec.toString().padStart(2, '0')}`;

                // Update caption display
                this.updateCaptionDisplay();
            }

            seekToTime(e) {
                const timeline = document.getElementById('timeline');
                const rect = timeline.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * this.duration;
                
                this.video.currentTime = newTime;
            }

            startDraggingPlayhead(e) {
                e.preventDefault();
                this.isDraggingPlayhead = true;
                const timeline = document.getElementById('timeline');
                
                const onMouseMove = (e) => {
                    if (!this.isDraggingPlayhead) return;
                    
                    const rect = timeline.getBoundingClientRect();
                    const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                    const percentage = x / rect.width;
                    this.video.currentTime = percentage * this.duration;
                };
                
                const onMouseUp = () => {
                    this.isDraggingPlayhead = false;
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }

            updateCaptionPosition() {
                if (!this.currentCaption) return;
                
                const positionX = parseFloat(document.getElementById('positionX').value);
                const positionY = parseFloat(document.getElementById('positionY').value);
                
                this.currentCaption.positionX = positionX;
                this.currentCaption.positionY = positionY;
                
                const overlay = document.getElementById('captionOverlay');
                overlay.style.left = `${positionX}%`;
                overlay.style.top = `${positionY}%`;
                overlay.style.transform = 'translate(-50%, -50%)';
            }

            async startTranscription() {
                document.getElementById('loadingOverlay').classList.remove('hidden');
                
                try {
                    // Simulated transcription - in a real app you'd use a speech-to-text service
                    await this.simulateTranscription();
                } catch (error) {
                    console.error('Transcription failed:', error);
                    alert('Transcription failed. Please try again.');
                } finally {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }
            }

            async simulateTranscription() {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Generate sample captions for demo
                const sampleCaptions = [
                    { start: 0, end: 3, text: "Welcome to our amazing video tutorial!" },
                    { start: 3.5, end: 7, text: "Today we'll learn about video editing techniques." },
                    { start: 7.5, end: 11, text: "First, let's understand the basic concepts." },
                    { start: 11.5, end: 15, text: "Video editing is both an art and a science." },
                    { start: 15.5, end: 19, text: "With the right tools, anyone can create professional content." }
                ];
                
                // Only add captions that fit within video duration
                this.captions = sampleCaptions.filter(caption => caption.end <= this.duration);
                this.renderCaptionSegments();
                this.updateCaptionList();
            }

            addCaption() {
                const startTime = this.currentTime;
                const endTime = Math.min(startTime + 3, this.duration);
                
                const newCaption = {
                    id: Date.now(),
                    start: startTime,
                    end: endTime,
                    text: "New caption text",
                    positionX: 50,
                    positionY: 80
                };
                
                this.captions.push(newCaption);
                this.captions.sort((a, b) => a.start - b.start);
                
                this.renderCaptionSegments();
                this.updateCaptionList();
                this.selectCaption(newCaption);
            }

            selectCaption(caption) {
                this.currentCaption = caption;
                
                // Update form fields
                document.getElementById('captionText').value = caption.text;
                document.getElementById('startTime').value = caption.start.toFixed(1);
                document.getElementById('endTime').value = caption.end.toFixed(1);
                document.getElementById('positionX').value = caption.positionX || 50;
                document.getElementById('positionY').value = caption.positionY || 80;
                
                // Update visual selection
                document.querySelectorAll('.caption-segment').forEach(el => {
                    el.classList.remove('selected');
                });
                document.querySelectorAll('.caption-item').forEach(el => {
                    el.classList.remove('selected');
                });
                
                const segmentEl = document.querySelector(`[data-caption-id="${caption.id}"]`);
                if (segmentEl) {
                    segmentEl.classList.add('selected');
                }
                
                // Update caption position
                this.updateCaptionPosition();
            }

            updateCaption() {
                if (!this.currentCaption) return;
                
                this.currentCaption.text = document.getElementById('captionText').value;
                this.currentCaption.start = parseFloat(document.getElementById('startTime').value);
                this.currentCaption.end = parseFloat(document.getElementById('endTime').value);
                this.currentCaption.positionX = parseFloat(document.getElementById('positionX').value);
                this.currentCaption.positionY = parseFloat(document.getElementById('positionY').value);
                
                this.captions.sort((a, b) => a.start - b.start);
                this.renderCaptionSegments();
                this.updateCaptionList();
                this.updateCaptionPosition();
            }

            deleteCaption() {
                if (!this.currentCaption) return;
                
                this.captions = this.captions.filter(c => c.id !== this.currentCaption.id);
                this.currentCaption = null;
                
                // Clear form
                document.getElementById('captionText').value = '';
                document.getElementById('startTime').value = '';
                document.getElementById('endTime').value = '';
                
                this.renderCaptionSegments();
                this.updateCaptionList();
            }

            renderCaptionSegments() {
                const container = document.getElementById('captionSegments');
                container.innerHTML = '';
                
                this.captions.forEach(caption => {
                    const segment = document.createElement('div');
                    segment.className = 'caption-segment';
                    segment.dataset.captionId = caption.id;
                    
                    const startPercent = (caption.start / this.duration) * 100;
                    const widthPercent = ((caption.end - caption.start) / this.duration) * 100;
                    
                    segment.style.left = `${startPercent}%`;
                    segment.style.width = `${widthPercent}%`;
                    segment.textContent = caption.text.substring(0, 20) + (caption.text.length > 20 ? '...' : '');
                    
                    segment.addEventListener('click', () => {
                        this.selectCaption(caption);
                        this.video.currentTime = caption.start;
                    });
                    
                    container.appendChild(segment);
                });
            }

            updateCaptionList() {
                const container = document.getElementById('captionList');
                
                if (this.captions.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No captions yet. Start by transcribing your video or adding captions manually.</div>';
                    return;
                }
                
                container.innerHTML = '';
                
                this.captions.forEach(caption => {
                    const item = document.createElement('div');
                    item.className = 'caption-item';
                    item.dataset.captionId = caption.id;
                    
                    const timeStr = `${this.formatTime(caption.start)} - ${this.formatTime(caption.end)}`;
                    
                    item.innerHTML = `
                        <div class="caption-time">${timeStr}</div>
                        <div class="caption-text">${caption.text}</div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.selectCaption(caption);
                        this.video.currentTime = caption.start;
                        this.switchTab({ target: { dataset: { tab: 'edit' } } });
                    });
                    
                    container.appendChild(item);
                });
            }

            formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }

            updateCaptionDisplay() {
                const overlay = document.getElementById('captionOverlay');
                const currentCaption = this.captions.find(caption => 
                    this.currentTime >= caption.start && this.currentTime <= caption.end
                );
                
                if (currentCaption) {
                    overlay.textContent = currentCaption.text;
                    overlay.style.display = 'block';
                } else {
                    overlay.style.display = 'none';
                }
            }

            updateStyle() {
                const fontSize = document.getElementById('fontSize').value;
                const textColor = document.getElementById('textColor').value;
                const backgroundColor = document.getElementById('backgroundColor').value;
                const backgroundOpacity = document.getElementById('backgroundOpacity').value;
                const fontWeight = document.getElementById('fontWeight').value;
                
                // Update value displays
                document.getElementById('fontSizeValue').textContent = fontSize + 'px';
                document.getElementById('backgroundOpacityValue').textContent = backgroundOpacity + '%';
                
                // Apply styles to caption overlay
                const overlay = document.getElementById('captionOverlay');
                overlay.style.fontSize = fontSize + 'px';
                overlay.style.color = textColor;
                overlay.style.fontWeight = fontWeight;
                
                // Convert hex to rgba for background
                const hex = backgroundColor.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                const alpha = backgroundOpacity / 100;
                
                overlay.style.background = `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }

            applyPreset(e) {
                const preset = e.target.dataset.preset;
                
                const presets = {
                    youtube: {
                        fontSize: 20,
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        backgroundOpacity: 80,
                        fontWeight: 'bold'
                    },
                    netflix: {
                        fontSize: 22,
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        backgroundOpacity: 70,
                        fontWeight: '500'
                    },
                    minimal: {
                        fontSize: 16,
                        textColor: '#333333',
                        backgroundColor: '#ffffff',
                        backgroundOpacity: 90,
                        fontWeight: 'normal'
                    },
                    bold: {
                        fontSize: 24,
                        textColor: '#ffff00',
                        backgroundColor: '#ff0000',
                        backgroundOpacity: 85,
                        fontWeight: '900'
                    }
                };
                
                const settings = presets[preset];
                if (settings) {
                    document.getElementById('fontSize').value = settings.fontSize;
                    document.getElementById('textColor').value = settings.textColor;
                    document.getElementById('backgroundColor').value = settings.backgroundColor;
                    document.getElementById('backgroundOpacity').value = settings.backgroundOpacity;
                    document.getElementById('fontWeight').value = settings.fontWeight;
                    
                    this.updateStyle();
                }
            }

            switchTab(e) {
                const tabName = e.target.dataset.tab;
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
                
                // Update panels
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(tabName + 'Panel').classList.add('active');
            }

            async exportVideo() {
                alert('Export functionality would integrate with a video processing service to render the final video with embedded captions. In a production environment, this would use FFmpeg.js or a server-side video processing API.');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new VideoCaptionEditor();
        });
    </script>
</body>
</html>