<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaptionCraft - Professional Video Caption Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/onnxruntime-web/1.17.1/ort.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/transformers.js/2.17.2/transformers.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
            color: white;
        }

        .header h1 {
            font-size: 3.2rem;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
            color: #b0b0b0;
        }

        .editor-container {
            background: #2a2a2a;
            border-radius: 16px;
            box-shadow: 0 24px 48px rgba(0,0,0,0.3);
            overflow: hidden;
            min-height: 850px;
            border: 1px solid #404040;
        }

        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 80px 32px;
            text-align: center;
            margin: 48px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #333333;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(102,126,234,0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-area:hover::before {
            opacity: 1;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #3a3a3a;
            transform: translateY(-4px);
        }

        .upload-area.drag-over {
            border-color: #4CAF50;
            background: #2d4a2d;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4.5rem;
            color: #667eea;
            margin-bottom: 24px;
            filter: drop-shadow(0 4px 8px rgba(102,126,234,0.3));
        }

        .upload-text {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: #ffffff;
            font-weight: 600;
        }

        .upload-subtext {
            color: #b0b0b0;
            font-size: 1rem;
        }

        .editor-workspace {
            display: none;
            grid-template-columns: 1fr 380px;
            height: 850px;
        }

        .main-editor {
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }

        .video-preview {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px 0 0 0;
            overflow: hidden;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 900px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 4px;
        }

        .caption-overlay {
            position: absolute;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            word-wrap: break-word;
            z-index: 10;
            cursor: move;
            user-select: none;
            border: 2px solid transparent;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 85%;
            min-width: 120px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .caption-overlay:hover {
            border-color: #667eea;
            background: rgba(102,126,234,0.9);
        }

        .caption-overlay.dragging {
            border-color: #ff6b35;
            background: rgba(255,107,53,0.9);
            box-shadow: 0 8px 24px rgba(255,107,53,0.4);
            transition: none;
        }

        .timeline-container {
            height: 200px;
            background: #1a1a1a;
            padding: 24px;
            overflow-x: auto;
            border-top: 1px solid #404040;
        }

        .timeline-wrapper {
            position: relative;
            margin-bottom: 24px;
        }

        .timeline-markers {
            position: relative;
            height: 24px;
            margin-bottom: 8px;
        }

        .time-marker {
            position: absolute;
            top: 0;
            width: 1px;
            height: 24px;
            background: rgba(255,255,255,0.2);
        }

        .time-marker.major {
            height: 24px;
            background: rgba(255,255,255,0.4);
            width: 2px;
        }

        .time-label {
            position: absolute;
            top: -20px;
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            transform: translateX(-50%);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-weight: 500;
        }

        .timeline {
            position: relative;
            height: 48px;
            background: #333333;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid #4a4a4a;
            transition: border-color 0.2s ease;
        }

        .timeline:hover {
            border-color: #667eea;
        }

        .timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            transition: width 0.1s ease;
        }

        .playhead {
            position: absolute;
            top: -4px;
            width: 3px;
            height: 56px;
            background: #ff6b35;
            border-radius: 2px;
            cursor: ew-resize;
            box-shadow: 0 0 8px rgba(255,107,53,0.6);
            z-index: 20;
        }

        .playhead::before {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            width: 11px;
            height: 11px;
            background: #ff6b35;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .caption-segments {
            position: relative;
            height: 48px;
            margin-top: 12px;
        }

        .caption-segment {
            position: absolute;
            height: 100%;
            background: rgba(102,126,234,0.8);
            border-radius: 4px;
            border: 1px solid #667eea;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 12px;
            color: white;
            overflow: hidden;
            white-space: nowrap;
            font-weight: 500;
            backdrop-filter: blur(4px);
        }

        .caption-segment:hover {
            background: rgba(102,126,234,1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102,126,234,0.4);
        }

        .caption-segment.selected {
            border-color: #4CAF50;
            background: rgba(76,175,80,0.9);
            box-shadow: 0 0 0 2px rgba(76,175,80,0.3);
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px 32px;
            background: #2a2a2a;
            border-top: 1px solid #404040;
        }

        .control-btn {
            background: #404040;
            color: white;
            border: 1px solid #5a5a5a;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 44px;
        }

        .control-btn:hover {
            background: #667eea;
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.3);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn:disabled {
            background: #2a2a2a;
            border-color: #3a3a3a;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.transcribe-ai {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-color: #4CAF50;
        }

        .control-btn.transcribe-ai:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76,175,80,0.3);
        }

        .time-display {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 15px;
            color: #e0e0e0;
            min-width: 140px;
            text-align: center;
            font-weight: 600;
            background: #333333;
            padding: 12px 16px;
            border-radius: 6px;
            border: 1px solid #4a4a4a;
        }

        .sidebar {
            background: #2a2a2a;
            border-left: 1px solid #404040;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 24px;
            background: #333333;
            border-bottom: 1px solid #404040;
        }

        .sidebar-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 16px;
        }

        .tab-buttons {
            display: flex;
            gap: 4px;
            background: #404040;
            border-radius: 8px;
            padding: 4px;
        }

        .tab-btn {
            padding: 10px 16px;
            border: none;
            background: transparent;
            color: #b0b0b0;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 14px;
            flex: 1;
            text-align: center;
        }

        .tab-btn:hover {
            background: rgba(102,126,234,0.2);
            color: #ffffff;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 4px rgba(102,126,234,0.3);
        }

        .sidebar-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: #2a2a2a;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #5a5a5a;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: #333333;
            color: #ffffff;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .form-input::placeholder {
            color: #888888;
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-input {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .range-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-input {
            flex: 1;
        }

        .range-value {
            min-width: 40px;
            text-align: center;
            font-weight: 500;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px 12px;
            border: 2px solid #5a5a5a;
            background: #333333;
            color: #ffffff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            border-color: #667eea;
            background: #404040;
        }

        .caption-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .caption-item {
            background: #333333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .caption-item:hover {
            background: #404040;
        }

        .caption-item.selected {
            border-left-color: #667eea;
            background: #404040;
        }

        .caption-time {
            font-size: 12px;
            color: #b0b0b0;
            margin-bottom: 5px;
        }

        .caption-text {
            font-size: 14px;
            color: #ffffff;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: #2a2a2a;
            color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            border: 1px solid #404040;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #404040;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-section {
            background: #333333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .export-btn {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.3);
        }

        .hidden {
            display: none !important;
        }

        .model-status {
            background: #333333;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 12px;
            border-left: 4px solid #667eea;
        }

        .model-status.loading {
            border-left-color: #ff9800;
        }

        .model-status.ready {
            border-left-color: #4CAF50;
        }

        .model-status.error {
            border-left-color: #f44336;
        }

        .language-selector {
            margin-bottom: 16px;
        }

        .language-selector select {
            width: 100%;
            padding: 8px 12px;
            background: #333333;
            color: #ffffff;
            border: 1px solid #5a5a5a;
            border-radius: 6px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .editor-workspace {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }
            
            .sidebar {
                border-left: none;
                border-top: 1px solid #404040;
                max-height: 400px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎬 CaptionCraft</h1>
            <p>Professional Video Caption Editor with Whisper AI Transcription</p>
        </div>

        <div class="editor-container">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📁</div>
                <div class="upload-text">Drop your video file here</div>
                <div class="upload-subtext">Supports MP4, MOV, AVI, WebM, MKV, M4V and more • Free AI transcription with Whisper</div>
                <input type="file" id="fileInput" accept=".mp4,.mov,.avi,.webm,.mkv,.m4v,.3gp,.flv" style="display: none;">
            </div>

            <div class="editor-workspace" id="editorWorkspace">
                <div class="main-editor">
                    <div class="video-preview">
                        <div class="video-container">
                            <video id="videoPlayer" controls>
                                Your browser does not support the video tag.
                            </video>
                            <div class="caption-overlay" id="captionOverlay"></div>
                        </div>
                    </div>

                    <div class="timeline-container">
                        <div class="timeline-wrapper">
                            <div class="timeline-markers" id="timelineMarkers"></div>
                            <div class="timeline" id="timeline">
                                <div class="timeline-progress" id="timelineProgress"></div>
                                <div class="playhead" id="playhead"></div>
                            </div>
                        </div>
                        <div class="caption-segments" id="captionSegments"></div>
                    </div>

                    <div class="controls">
                        <button class="control-btn" id="playPauseBtn">
                            <span>▶️</span> Play
                        </button>
                        <button class="control-btn transcribe-ai" id="transcribeBtn">
                            <span>🤖</span> AI Transcribe
                        </button>
                        <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                        <button class="control-btn" id="addCaptionBtn">
                            <span>➕</span> Add Caption
                        </button>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="sidebar-header">
                        <div class="sidebar-title">Caption Editor</div>
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="edit">Edit</button>
                            <button class="tab-btn" data-tab="style">Style</button>
                            <button class="tab-btn" data-tab="list">List</button>
                        </div>
                    </div>

                    <div class="sidebar-content">
                        <div class="model-status" id="modelStatus">
                            <div>🔄 Loading Whisper AI model...</div>
                            <div style="font-size: 10px; margin-top: 4px; opacity: 0.7;">First load may take a few moments</div>
                        </div>

                        <div class="tab-panel active" id="editPanel">
                            <div class="language-selector">
                                <label class="form-label">Transcription Language</label>
                                <select id="languageSelect">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="ru">Russian</option>
                                    <option value="ja">Japanese</option>
                                    <option value="ko">Korean</option>
                                    <option value="zh">Chinese</option>
                                    <option value="ar">Arabic</option>
                                    <option value="hi">Hindi</option>
                                    <option value="auto">Auto-detect</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Caption Text</label>
                                <textarea class="form-input textarea" id="captionText" placeholder="Enter caption text..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Time (seconds)</label>
                                <input type="number" class="form-input" id="startTime" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time (seconds)</label>
                                <input type="number" class="form-input" id="endTime" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Position</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label style="font-size: 12px; color: #888;">X Position (%)</label>
                                        <input type="number" class="form-input" id="positionX" min="15" max="85" value="50">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #888;">Y Position (%)</label>
                                        <input type="number" class="form-input" id="positionY" min="15" max="85" value="75">
                                    </div>
                                </div>
                            </div>
                            <button class="control-btn" id="updateCaptionBtn" style="width: 100%;">
                                Update Caption
                            </button>
                            <button class="control-btn" id="deleteCaptionBtn" style="width: 100%; background: #dc3545; margin-top: 10px;">
                                Delete Caption
                            </button>
                        </div>

                        <div class="tab-panel" id="stylePanel">
                            <div class="form-group">
                                <label class="form-label">Font Size</label>
                                <div class="range-group">
                                    <input type="range" class="range-input" id="fontSize" min="12" max="48" value="18">
                                    <span class="range-value" id="fontSizeValue">18px</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="textColor" value="#ffffff">
                                    <span>Text</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="backgroundColor" value="#000000">
                                    <span>Background</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Background Opacity</label>
                                <div class="range-group">
                                    <input type="range" class="range-input" id="backgroundOpacity" min="0" max="100" value="80">
                                    <span class="range-value" id="backgroundOpacityValue">80%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Font Weight</label>
                                <select class="form-input" id="fontWeight">
                                    <option value="normal">Normal</option>
                                    <option value="bold" selected>Bold</option>
                                    <option value="300">Light</option>
                                    <option value="600">Semi Bold</option>
                                    <option value="900">Extra Bold</option>
                                </select>
                            </div>
                            <div class="preset-buttons">
                                <button class="preset-btn" data-preset="youtube">YouTube Style</button>
                                <button class="preset-btn" data-preset="netflix">Netflix Style</button>
                                <button class="preset-btn" data-preset="minimal">Minimal</button>
                                <button class="preset-btn" data-preset="bold">Bold & Bright</button>
                            </div>
                        </div>

                        <div class="tab-panel" id="listPanel">
                            <div class="caption-list" id="captionList">
                                <div style="text-align: center; color: #666; padding: 40px;">
                                    No captions yet. Upload a video and use AI transcription to get started automatically.
                                </div>
                            </div>
                            <div class="export-section">
                                <button class="export-btn" id="exportBtn">
                                    📥 Export Video with Captions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading hidden" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3 id="loadingTitle">AI Transcription in Progress</h3>
                <p id="loadingMessage">Extracting audio and processing with Whisper AI...</p>
                <div style="margin-top: 16px; font-size: 12px; color: #b0b0b0; text-align: left;">
                    <strong>Whisper AI Benefits:</strong><br>
                    • Works completely offline in your browser<br>
                    • High accuracy even with accents and background noise<br>
                    • Supports 90+ languages with auto-detection<br>
                    • Free to use with no API calls required<br>
                    • Processes audio locally for privacy
                </div>
                <div style="margin-top: 12px; width: 100%; background: #333; border-radius: 4px; height: 8px;">
                    <div id="transcriptionProgress" style="width: 0%; background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; border-radius: 4px; transition: width 0.3s;"></div>
                </div>
                <div id="progressText" style="margin-top: 8px; font-size: 12px; color: #b0b0b0;">Initializing...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Transformers.js for Whisper
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

        // Configure transformers environment
        env.allowRemoteModels = false;
        env.allowLocalModels = true;

        class VideoCaptionEditor {
            constructor() {
                this.video = null;
                this.captions = [];
                this.currentCaption = null;
                this.isPlaying = false;
                this.duration = 0;
                this.currentTime = 0;
                this.isDraggingCaption = false;
                this.isDraggingPlayhead = false;
                this.whisperPipeline = null;
                this.modelStatus = 'loading';
                
                this.init();
            }

            async init() {
                this.setupEventListeners();
                this.setupDragAndDrop();
                this.setupCaptionDragging();
                await this.initializeWhisper();
            }

            async initializeWhisper() {
                try {
                    console.log('Loading Whisper model...');
                    this.updateModelStatus('loading', '🔄 Loading Whisper AI model...', 'This may take a few moments on first load');
                    
                    // Load Whisper model (using tiny model for faster loading)
                    this.whisperPipeline = await pipeline(
                        'automatic-speech-recognition',
                        'Xenova/whisper-tiny.en',
                        {
                            dtype: {
                                encoder_model: 'fp16',
                                decoder_model_merged: 'q4'
                            },
                            device: 'webgpu',
                            // Fallback to CPU if WebGPU is not available
                            fallback_device: 'cpu'
                        }
                    );
                    
                    console.log('Whisper model loaded successfully');
                    this.updateModelStatus('ready', '✅ Whisper AI ready', 'Ready for high-quality transcription');
                    this.modelStatus = 'ready';
                    
                } catch (error) {
                    console.error('Failed to load Whisper model:', error);
                    this.updateModelStatus('error', '❌ Model loading failed', 'Please refresh the page to try again');
                    this.modelStatus = 'error';
                }
            }

            updateModelStatus(status, title, subtitle) {
                const statusEl = document.getElementById('modelStatus');
                statusEl.className = `model-status ${status}`;
                statusEl.innerHTML = `
                    <div>${title}</div>
                    <div style="font-size: 10px; margin-top: 4px; opacity: 0.7;">${subtitle}</div>
                `;
            }

            setupEventListeners() {
                // File upload
                document.getElementById('fileInput').addEventListener('change', this.handleFileSelect.bind(this));
                document.getElementById('uploadArea').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });

                // Video controls
                document.getElementById('playPauseBtn').addEventListener('click', this.togglePlayPause.bind(this));
                document.getElementById('transcribeBtn').addEventListener('click', this.startWhisperTranscription.bind(this));
                document.getElementById('addCaptionBtn').addEventListener('click', this.addCaption.bind(this));

                // Caption editing
                document.getElementById('updateCaptionBtn').addEventListener('click', this.updateCaption.bind(this));
                document.getElementById('deleteCaptionBtn').addEventListener('click', this.deleteCaption.bind(this));

                // Position controls
                document.getElementById('positionX').addEventListener('input', this.updateCaptionPosition.bind(this));
                document.getElementById('positionY').addEventListener('input', this.updateCaptionPosition.bind(this));

                // Timeline
                document.getElementById('timeline').addEventListener('click', this.seekToTime.bind(this));
                document.getElementById('playhead').addEventListener('mousedown', this.startDraggingPlayhead.bind(this));

                // Style controls
                document.getElementById('fontSize').addEventListener('input', this.updateStyle.bind(this));
                document.getElementById('textColor').addEventListener('change', this.updateStyle.bind(this));
                document.getElementById('backgroundColor').addEventListener('change', this.updateStyle.bind(this));
                document.getElementById('backgroundOpacity').addEventListener('input', this.updateStyle.bind(this));
                document.getElementById('fontWeight').addEventListener('change', this.updateStyle.bind(this));

                // Preset buttons
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', this.applyPreset.bind(this));
                });

                // Tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', this.switchTab.bind(this));
                });

                // Export
                document.getElementById('exportBtn').addEventListener('click', this.exportVideo.bind(this));
            }

            setupDragAndDrop() {
                const uploadArea = document.getElementById('uploadArea');

                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', (e) => {
                    if (!uploadArea.contains(e.relatedTarget)) {
                        uploadArea.classList.remove('drag-over');
                    }
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    
                    const files = e.dataTransfer.files;
                    if (files.length === 0) {
                        alert('No files detected. Please try again.');
                        return;
                    }
                    
                    if (files.length > 1) {
                        alert('Please drop only one video file at a time.');
                        return;
                    }
                    
                    const file = files[0];
                    
                    if (!file.type.startsWith('video/') && !file.name.match(/\.(mp4|mov|avi|webm|mkv|m4v|3gp|flv)$/i)) {
                        alert('Please drop a valid video file (MP4, MOV, AVI, WebM, MKV, M4V, 3GP, or FLV).');
                        return;
                    }
                    
                    this.loadVideo(file);
                });

                document.addEventListener('paste', (e) => {
                    const items = e.clipboardData?.items;
                    if (!items) return;
                    
                    for (let item of items) {
                        if (item.type.startsWith('video/')) {
                            const file = item.getAsFile();
                            if (file) {
                                this.loadVideo(file);
                                break;
                            }
                        }
                    }
                });
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.loadVideo(file);
                }
            }

            setupCaptionDragging() {
                const overlay = document.getElementById('captionOverlay');
                
                overlay.addEventListener('mousedown', (e) => {
                    const currentDisplayedCaption = this.captions.find(caption => 
                        this.currentTime >= caption.start && this.currentTime <= caption.end
                    );
                    
                    if (!currentDisplayedCaption) return;
                    
                    this.isDraggingCaption = true;
                    overlay.classList.add('dragging');
                    
                    const videoContainer = document.querySelector('.video-container');
                    const rect = videoContainer.getBoundingClientRect();
                    const overlayRect = overlay.getBoundingClientRect();
                    
                    const offsetX = e.clientX - (overlayRect.left + overlayRect.width / 2);
                    const offsetY = e.clientY - (overlayRect.top + overlayRect.height / 2);
                    
                    const onMouseMove = (e) => {
                        if (!this.isDraggingCaption) return;
                        
                        const rect = videoContainer.getBoundingClientRect();
                        
                        const centerX = e.clientX - offsetX;
                        const centerY = e.clientY - offsetY;
                        
                        const x = ((centerX - rect.left) / rect.width) * 100;
                        const y = ((centerY - rect.top) / rect.height) * 100;
                        
                        const clampedX = Math.max(15, Math.min(85, x));
                        const clampedY = Math.max(15, Math.min(85, y));
                        
                        currentDisplayedCaption.positionX = clampedX;
                        currentDisplayedCaption.positionY = clampedY;
                        
                        overlay.style.left = `${clampedX}%`;
                        overlay.style.top = `${clampedY}%`;
                        overlay.style.transform = 'translate(-50%, -50%)';
                        
                        if (this.currentCaption && this.currentCaption.id === currentDisplayedCaption.id) {
                            document.getElementById('positionX').value = Math.round(clampedX);
                            document.getElementById('positionY').value = Math.round(clampedY);
                        }
                    };
                    
                    const onMouseUp = () => {
                        this.isDraggingCaption = false;
                        overlay.classList.remove('dragging');
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                        
                        if (this.currentCaption && this.currentCaption.id !== currentDisplayedCaption.id) {
                            this.selectCaption(currentDisplayedCaption);
                        }
                    };
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                    
                    e.preventDefault();
                    e.stopPropagation();
                });
            }

            loadVideo(file) {
                const supportedTypes = [
                    'video/mp4', 'video/quicktime', 'video/x-msvideo', 
                    'video/webm', 'video/x-matroska', 'video/mp4v-es',
                    'video/3gpp', 'video/x-flv'
                ];
                
                if (!supportedTypes.includes(file.type) && !file.name.match(/\.(mp4|mov|avi|webm|mkv|m4v|3gp|flv)$/i)) {
                    alert('Unsupported video format. Please use MP4, MOV, AVI, WebM, MKV, M4V, 3GP, or FLV files.');
                    return;
                }

                const maxSize = 500 * 1024 * 1024; // 500MB
                if (file.size > maxSize) {
                    const proceed = confirm(
                        `This video file is ${Math.round(file.size / (1024 * 1024))}MB, which is quite large. ` +
                        `Processing may take longer and could use significant memory.\n\n` +
                        `For best performance, consider using a smaller file or compressing the video.\n\n` +
                        `Continue anyway?`
                    );
                    if (!proceed) return;
                }

                const videoURL = URL.createObjectURL(file);
                this.video = document.getElementById('videoPlayer');
                this.video.src = videoURL;
                this.videoFile = file; // Store file for audio extraction
                
                this.video.addEventListener('error', (e) => {
                    console.error('Video loading error:', e);
                    alert('Unable to load this video file. The format may not be supported by your browser, or the file may be corrupted.');
                }, { once: true });
                
                this.video.addEventListener('loadedmetadata', () => {
                    this.duration = this.video.duration;
                    this.setupVideoEvents();
                    this.createTimelineMarkers();
                    this.showEditor();
                    
                    setTimeout(() => {
                        URL.revokeObjectURL(videoURL);
                    }, 1000);
                }, { once: true });
                
                this.video.addEventListener('loadstart', () => {
                    console.log('Loading video...');
                }, { once: true });
            }

            createTimelineMarkers() {
                const markersContainer = document.getElementById('timelineMarkers');
                markersContainer.innerHTML = '';
                
                const duration = this.duration;
                const intervals = this.getTimeIntervals(duration);
                
                intervals.forEach(time => {
                    const marker = document.createElement('div');
                    marker.className = time % 60 === 0 ? 'time-marker major' : 'time-marker';
                    
                    const percentage = (time / duration) * 100;
                    marker.style.left = `${percentage}%`;
                    
                    if (time % 10 === 0 || time % 60 === 0) {
                        const label = document.createElement('div');
                        label.className = 'time-label';
                        label.textContent = this.formatTime(time);
                        label.style.left = `${percentage}%`;
                        markersContainer.appendChild(label);
                    }
                    
                    markersContainer.appendChild(marker);
                });
            }

            getTimeIntervals(duration) {
                const intervals = [];
                
                if (duration <= 60) {
                    for (let i = 0; i <= duration; i += 5) {
                        intervals.push(i);
                    }
                } else if (duration <= 300) {
                    for (let i = 0; i <= duration; i += 10) {
                        intervals.push(i);
                    }
                } else {
                    for (let i = 0; i <= duration; i += 30) {
                        intervals.push(i);
                    }
                }
                
                return intervals;
            }

            setupVideoEvents() {
                this.video.addEventListener('timeupdate', this.updateTimeline.bind(this));
                this.video.addEventListener('play', () => {
                    this.isPlaying = true;
                    this.updatePlayButton();
                });
                this.video.addEventListener('pause', () => {
                    this.isPlaying = false;
                    this.updatePlayButton();
                });
            }

            showEditor() {
                document.getElementById('uploadArea').style.display = 'none';
                document.getElementById('editorWorkspace').style.display = 'grid';
            }

            togglePlayPause() {
                if (this.isPlaying) {
                    this.video.pause();
                } else {
                    this.video.play();
                }
            }

            updatePlayButton() {
                const btn = document.getElementById('playPauseBtn');
                btn.innerHTML = this.isPlaying ? '<span>⏸️</span> Pause' : '<span>▶️</span> Play';
            }

            updateTimeline() {
                this.currentTime = this.video.currentTime;
                const progress = (this.currentTime / this.duration) * 100;
                
                document.getElementById('timelineProgress').style.width = `${progress}%`;
                document.getElementById('playhead').style.left = `${progress}%`;
                
                const currentMin = Math.floor(this.currentTime / 60);
                const currentSec = Math.floor(this.currentTime % 60);
                const durationMin = Math.floor(this.duration / 60);
                const durationSec = Math.floor(this.duration % 60);
                
                document.getElementById('timeDisplay').textContent = 
                    `${currentMin.toString().padStart(2, '0')}:${currentSec.toString().padStart(2, '0')} / ${durationMin.toString().padStart(2, '0')}:${durationSec.toString().padStart(2, '0')}`;

                this.updateCaptionDisplay();
            }

            seekToTime(e) {
                const timeline = document.getElementById('timeline');
                const rect = timeline.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * this.duration;
                
                this.video.currentTime = newTime;
            }

            startDraggingPlayhead(e) {
                e.preventDefault();
                this.isDraggingPlayhead = true;
                const timeline = document.getElementById('timeline');
                
                const onMouseMove = (e) => {
                    if (!this.isDraggingPlayhead) return;
                    
                    const rect = timeline.getBoundingClientRect();
                    const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
                    const percentage = x / rect.width;
                    this.video.currentTime = percentage * this.duration;
                };
                
                const onMouseUp = () => {
                    this.isDraggingPlayhead = false;
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }

            async startWhisperTranscription() {
                if (!this.video || !this.video.src) {
                    alert('Please upload a video first');
                    return;
                }

                if (this.modelStatus !== 'ready') {
                    alert('Whisper AI model is not ready yet. Please wait for it to load or refresh the page if there was an error.');
                    return;
                }

                document.getElementById('loadingOverlay').classList.remove('hidden');
                document.getElementById('progressText').textContent = 'Extracting audio from video...';
                
                const progressBar = document.getElementById('transcriptionProgress');
                progressBar.style.width = '0%';
                
                try {
                    // Extract audio from video
                    document.getElementById('progressText').textContent = 'Extracting audio from video...';
                    progressBar.style.width = '20%';
                    
                    const audioBlob = await this.extractAudioFromVideo();
                    
                    document.getElementById('progressText').textContent = 'Running Whisper AI transcription...';
                    progressBar.style.width = '40%';
                    
                    // Convert audio blob to array buffer for Whisper
                    const audioBuffer = await audioBlob.arrayBuffer();
                    
                    // Get selected language
                    const language = document.getElementById('languageSelect').value;
                    const options = {
                        language: language === 'auto' ? null : language,
                        task: 'transcribe',
                        return_timestamps: true,
                        chunk_length_s: 30,
                        stride_length_s: 5
                    };
                    
                    document.getElementById('progressText').textContent = 'Processing with Whisper AI...';
                    progressBar.style.width = '60%';
                    
                    // Run Whisper transcription
                    const result = await this.whisperPipeline(audioBuffer, options);
                    
                    document.getElementById('progressText').textContent = 'Creating captions...';
                    progressBar.style.width = '80%';
                    
                    // Process the results
                    this.processWhisperResults(result);
                    
                    progressBar.style.width = '100%';
                    document.getElementById('progressText').textContent = 'Complete!';
                    
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').classList.add('hidden');
                    }, 1000);
                    
                } catch (error) {
                    console.error('Whisper transcription failed:', error);
                    document.getElementById('loadingOverlay').classList.add('hidden');
                    alert(`Transcription failed: ${error.message}\n\nPlease try with a shorter video or check that the video has clear audio.`);
                }
            }

            async extractAudioFromVideo() {
                return new Promise((resolve, reject) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Create a temporary video element
                    const video = document.createElement('video');
                    video.src = this.video.src;
                    video.crossOrigin = 'anonymous';
                    
                    video.addEventListener('loadeddata', async () => {
                        try {
                            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            
                            // Create media element source
                            const source = audioContext.createMediaElementSource(video);
                            const destination = audioContext.createMediaStreamDestination();
                            
                            // Connect source to destination
                            source.connect(destination);
                            
                            // Create MediaRecorder to capture audio
                            const mediaRecorder = new MediaRecorder(destination.stream, {
                                mimeType: 'audio/webm'
                            });
                            
                            const audioChunks = [];
                            
                            mediaRecorder.ondataavailable = (event) => {
                                if (event.data.size > 0) {
                                    audioChunks.push(event.data);
                                }
                            };
                            
                            mediaRecorder.onstop = () => {
                                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                                resolve(audioBlob);
                            };
                            
                            // Start recording and play video
                            mediaRecorder.start();
                            video.play();
                            
                            // Stop when video ends
                            video.addEventListener('ended', () => {
                                mediaRecorder.stop();
                                source.disconnect();
                                audioContext.close();
                            });
                            
                        } catch (error) {
                            reject(new Error(`Audio extraction failed: ${error.message}`));
                        }
                    });
                    
                    video.addEventListener('error', () => {
                        reject(new Error('Failed to load video for audio extraction'));
                    });
                });
            }

            processWhisperResults(result) {
                console.log('Whisper results:', result);
                
                let transcripts = [];
                
                if (result.chunks && result.chunks.length > 0) {
                    // Handle chunked results with timestamps
                    transcripts = result.chunks.map(chunk => ({
                        text: chunk.text.trim(),
                        start: chunk.timestamp[0] || 0,
                        end: chunk.timestamp[1] || (chunk.timestamp[0] + 3)
                    }));
                } else if (result.text) {
                    // Handle single text result - create segments
                    const text = result.text.trim();
                    const words = text.split(' ');
                    const wordsPerSegment = 8;
                    const segmentDuration = 4;
                    
                    for (let i = 0; i < words.length; i += wordsPerSegment) {
                        const segmentWords = words.slice(i, i + wordsPerSegment);
                        const segmentStart = (i / wordsPerSegment) * segmentDuration;
                        const segmentEnd = segmentStart + segmentDuration;
                        
                        if (segmentEnd <= this.duration) {
                            transcripts.push({
                                text: segmentWords.join(' '),
                                start: segmentStart,
                                end: Math.min(segmentEnd, this.duration)
                            });
                        }
                    }
                }
                
                // Filter out empty or very short transcripts
                transcripts = transcripts.filter(t => t.text && t.text.length > 2);
                
                if (transcripts.length === 0) {
                    alert('No speech was detected in the video. Please ensure the video contains clear spoken audio.');
                    return;
                }
                
                // Convert to caption format with improved text processing
                this.captions = transcripts.map((transcript, index) => ({
                    id: Date.now() + index,
                    start: Math.max(0, transcript.start),
                    end: Math.min(transcript.end, this.duration),
                    text: this.cleanTranscriptText(transcript.text),
                    positionX: 50,
                    positionY: 75
                }));
                
                this.renderCaptionSegments();
                this.updateCaptionList();
                
                console.log(`Generated ${this.captions.length} captions from Whisper transcription`);
                
                // Auto-select first caption
                if (this.captions.length > 0) {
                    this.selectCaption(this.captions[0]);
                }
            }

            cleanTranscriptText(text) {
                return text
                    .trim()
                    .replace(/\s+/g, ' ') // Normalize whitespace
                    .replace(/^\w/, c => c.toUpperCase()) // Capitalize first letter
                    .replace(/([.!?])\s*$/g, '$1'); // Ensure proper ending punctuation
            }

            updateCaptionPosition() {
                if (!this.currentCaption) return;
                
                const positionX = parseFloat(document.getElementById('positionX').value);
                const positionY = parseFloat(document.getElementById('positionY').value);
                
                this.currentCaption.positionX = positionX;
                this.currentCaption.positionY = positionY;
                
                const overlay = document.getElementById('captionOverlay');
                overlay.style.left = `${positionX}%`;
                overlay.style.top = `${positionY}%`;
                overlay.style.transform = 'translate(-50%, -50%)';
            }

            addCaption() {
                const startTime = this.currentTime;
                const endTime = Math.min(startTime + 3, this.duration);
                
                const newCaption = {
                    id: Date.now(),
                    start: startTime,
                    end: endTime,
                    text: "New caption text",
                    positionX: 50,
                    positionY: 75
                };
                
                this.captions.push(newCaption);
                this.captions.sort((a, b) => a.start - b.start);
                
                this.renderCaptionSegments();
                this.updateCaptionList();
                this.selectCaption(newCaption);
            }

            selectCaption(caption) {
                this.currentCaption = caption;
                
                document.getElementById('captionText').value = caption.text;
                document.getElementById('startTime').value = caption.start.toFixed(1);
                document.getElementById('endTime').value = caption.end.toFixed(1);
                document.getElementById('positionX').value = caption.positionX !== undefined ? Math.round(caption.positionX) : 50;
                document.getElementById('positionY').value = caption.positionY !== undefined ? Math.round(caption.positionY) : 75;
                
                if (caption.positionX === undefined) caption.positionX = 50;
                if (caption.positionY === undefined) caption.positionY = 75;
                
                document.querySelectorAll('.caption-segment').forEach(el => {
                    el.classList.remove('selected');
                });
                document.querySelectorAll('.caption-item').forEach(el => {
                    el.classList.remove('selected');
                });
                
                const segmentEl = document.querySelector(`[data-caption-id="${caption.id}"]`);
                if (segmentEl) {
                    segmentEl.classList.add('selected');
                }
            }

            updateCaption() {
                if (!this.currentCaption) return;
                
                this.currentCaption.text = document.getElementById('captionText').value;
                this.currentCaption.start = parseFloat(document.getElementById('startTime').value);
                this.currentCaption.end = parseFloat(document.getElementById('endTime').value);
                this.currentCaption.positionX = parseFloat(document.getElementById('positionX').value);
                this.currentCaption.positionY = parseFloat(document.getElementById('positionY').value);
                
                this.captions.sort((a, b) => a.start - b.start);
                this.renderCaptionSegments();
                this.updateCaptionList();
                this.updateCaptionPosition();
            }

            deleteCaption() {
                if (!this.currentCaption) return;
                
                this.captions = this.captions.filter(c => c.id !== this.currentCaption.id);
                this.currentCaption = null;
                
                document.getElementById('captionText').value = '';
                document.getElementById('startTime').value = '';
                document.getElementById('endTime').value = '';
                
                this.renderCaptionSegments();
                this.updateCaptionList();
            }

            renderCaptionSegments() {
                const container = document.getElementById('captionSegments');
                container.innerHTML = '';
                
                this.captions.forEach(caption => {
                    const segment = document.createElement('div');
                    segment.className = 'caption-segment';
                    segment.dataset.captionId = caption.id;
                    
                    const startPercent = (caption.start / this.duration) * 100;
                    const widthPercent = ((caption.end - caption.start) / this.duration) * 100;
                    
                    segment.style.left = `${startPercent}%`;
                    segment.style.width = `${widthPercent}%`;
                    segment.textContent = caption.text.substring(0, 20) + (caption.text.length > 20 ? '...' : '');
                    
                    segment.addEventListener('click', () => {
                        this.selectCaption(caption);
                        this.video.currentTime = caption.start;
                    });
                    
                    container.appendChild(segment);
                });
            }

            updateCaptionList() {
                const container = document.getElementById('captionList');
                
                if (this.captions.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No captions yet. Upload a video and use AI transcription to get started automatically.</div>';
                    return;
                }
                
                container.innerHTML = '';
                
                this.captions.forEach(caption => {
                    const item = document.createElement('div');
                    item.className = 'caption-item';
                    item.dataset.captionId = caption.id;
                    
                    const timeStr = `${this.formatTime(caption.start)} - ${this.formatTime(caption.end)}`;
                    
                    item.innerHTML = `
                        <div class="caption-time">${timeStr}</div>
                        <div class="caption-text">${caption.text}</div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.selectCaption(caption);
                        this.video.currentTime = caption.start;
                        this.switchTab({ target: { dataset: { tab: 'edit' } } });
                    });
                    
                    container.appendChild(item);
                });
            }

            formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }

            updateCaptionDisplay() {
                const overlay = document.getElementById('captionOverlay');
                const currentCaption = this.captions.find(caption => 
                    this.currentTime >= caption.start && this.currentTime <= caption.end
                );
                
                if (currentCaption) {
                    overlay.textContent = currentCaption.text;
                    overlay.style.display = 'block';
                    overlay.style.left = `${currentCaption.positionX || 50}%`;
                    overlay.style.top = `${currentCaption.positionY || 75}%`;
                    overlay.style.transform = 'translate(-50%, -50%)';
                } else {
                    overlay.style.display = 'none';
                }
            }

            updateStyle() {
                const fontSize = document.getElementById('fontSize').value;
                const textColor = document.getElementById('textColor').value;
                const backgroundColor = document.getElementById('backgroundColor').value;
                const backgroundOpacity = document.getElementById('backgroundOpacity').value;
                const fontWeight = document.getElementById('fontWeight').value;
                
                document.getElementById('fontSizeValue').textContent = fontSize + 'px';
                document.getElementById('backgroundOpacityValue').textContent = backgroundOpacity + '%';
                
                const overlay = document.getElementById('captionOverlay');
                overlay.style.fontSize = fontSize + 'px';
                overlay.style.color = textColor;
                overlay.style.fontWeight = fontWeight;
                
                const hex = backgroundColor.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                const alpha = backgroundOpacity / 100;
                
                overlay.style.background = `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }

            applyPreset(e) {
                const preset = e.target.dataset.preset;
                
                const presets = {
                    youtube: {
                        fontSize: 20,
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        backgroundOpacity: 80,
                        fontWeight: 'bold'
                    },
                    netflix: {
                        fontSize: 22,
                        textColor: '#ffffff',
                        backgroundColor: '#000000',
                        backgroundOpacity: 70,
                        fontWeight: '500'
                    },
                    minimal: {
                        fontSize: 16,
                        textColor: '#333333',
                        backgroundColor: '#ffffff',
                        backgroundOpacity: 90,
                        fontWeight: 'normal'
                    },
                    bold: {
                        fontSize: 24,
                        textColor: '#ffff00',
                        backgroundColor: '#ff0000',
                        backgroundOpacity: 85,
                        fontWeight: '900'
                    }
                };
                
                const settings = presets[preset];
                if (settings) {
                    document.getElementById('fontSize').value = settings.fontSize;
                    document.getElementById('textColor').value = settings.textColor;
                    document.getElementById('backgroundColor').value = settings.backgroundColor;
                    document.getElementById('backgroundOpacity').value = settings.backgroundOpacity;
                    document.getElementById('fontWeight').value = settings.fontWeight;
                    
                    this.updateStyle();
                }
            }

            switchTab(e) {
                const tabName = e.target.dataset.tab;
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
                
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(tabName + 'Panel').classList.add('active');
            }

            async exportVideo() {
                alert('Export functionality would integrate with a video processing service to render the final video with embedded captions. In a production environment, this would use FFmpeg.js or a server-side video processing API.');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new VideoCaptionEditor();
        });
    </script>
</body>
</html>